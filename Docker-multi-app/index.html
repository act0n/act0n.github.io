<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Docker多容器应用 - 阿东zza</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="阿东zza"><meta name="msapplication-TileImage" content="/images/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="阿东zza"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="前言:wind_face: 本篇文章大部分是docker的官方英文文档内的内容，自己对这些内容进行了尝试，然后加了一些自己的解释和实践。这是比较简单的多容器应用，未来会再尝试构建更复杂的多容器应用的。 我们一直在使用单容器应用程序。但是，我们现在想要将 MySQL 添加到应用程序中。经常会出现下面的问题——“MySQL会在哪里运行？安装在同一个容器中还是单独运行？”  Tips：如果想了解单容器应"><meta property="og:type" content="blog"><meta property="og:title" content="(&gt;_&lt;)"><meta property="og:url" content="https://adyoow.github.io/Docker-multi-app/"><meta property="og:site_name" content="阿东zza"><meta property="og:description" content="前言:wind_face: 本篇文章大部分是docker的官方英文文档内的内容，自己对这些内容进行了尝试，然后加了一些自己的解释和实践。这是比较简单的多容器应用，未来会再尝试构建更复杂的多容器应用的。 我们一直在使用单容器应用程序。但是，我们现在想要将 MySQL 添加到应用程序中。经常会出现下面的问题——“MySQL会在哪里运行？安装在同一个容器中还是单独运行？”  Tips：如果想了解单容器应"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.wydgit.top/blog/docker-multi-app/multi-app-architecture.png"><meta property="og:image" content="https://cdn.wydgit.top/blog/docker-multi-app/dashboard-multi-container-app.png"><meta property="og:image" content="https://cdn.wydgit.top/blog/docker-multi-app/dashboard-app-project-expanded.png"><meta property="article:published_time" content="2021-07-15T03:02:20.000Z"><meta property="article:modified_time" content="2021-11-28T02:42:46.296Z"><meta property="article:author" content="adyoow"><meta property="article:tag" content="Docker"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://cdn.wydgit.top/blog/docker-multi-app/multi-app-architecture.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://adyoow.github.io/Docker-multi-app/"},"headline":"Docker多容器应用","image":["https://cdn.wydgit.top/blog/docker-multi-app/multi-app-architecture.png","https://cdn.wydgit.top/blog/docker-multi-app/dashboard-multi-container-app.png","https://cdn.wydgit.top/blog/docker-multi-app/dashboard-app-project-expanded.png"],"datePublished":"2021-07-15T03:02:20.000Z","dateModified":"2021-11-28T02:42:46.296Z","author":{"@type":"Person","name":"adyoow"},"publisher":{"@type":"Organization","name":"阿东zza","logo":{"@type":"ImageObject","url":"https://adyoow.github.io/images/logo.svg"}},"description":"前言:wind_face: 本篇文章大部分是docker的官方英文文档内的内容，自己对这些内容进行了尝试，然后加了一些自己的解释和实践。这是比较简单的多容器应用，未来会再尝试构建更复杂的多容器应用的。 我们一直在使用单容器应用程序。但是，我们现在想要将 MySQL 添加到应用程序中。经常会出现下面的问题——“MySQL会在哪里运行？安装在同一个容器中还是单独运行？”  Tips：如果想了解单容器应"}</script><link rel="canonical" href="https://adyoow.github.io/Docker-multi-app/"><link rel="icon" href="/images/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo.svg" alt="阿东zza" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">类别</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于我</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-07-15T03:02:20.000Z" title="2021/7/15 上午11:02:20">2021-07-15</time>发表</span><span class="level-item"><time dateTime="2021-11-28T02:42:46.296Z" title="2021/11/28 上午10:42:46">2021-11-28</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Study-Share/">Study Share</a></span><span class="level-item">29 分钟读完 (大约4412个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Docker多容器应用</h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>:wind_face: <em>本篇文章大部分是docker的官方英文文档内的内容，自己对这些内容进行了尝试，然后加了一些自己的解释和实践。这是比较简单的多容器应用，未来会再尝试构建更复杂的多容器应用的。</em></p>
<p>我们一直在使用单容器应用程序。但是，我们现在想要将 MySQL 添加到应用程序中。经常会出现下面的问题——“MySQL会在哪里运行？安装在同一个容器中还是单独运行？” </p>
<p><strong>Tips</strong>：如果想了解单容器应用或者更多基础内容，可以看 <a target="_blank" rel="noopener" href="https://github.com/docker/getting-started/blob/master/docs/tutorial/our-application/index.md">Our-application</a>、<a target="_blank" rel="noopener" href="https://wydgits.github.io/Docker-learning-notes/">Docker-learning-notes</a></p>
<span id="more"></span>

<p>一般来说，<strong>每个容器都应该做一件事，并且做好。</strong> 因此，我们将更新我们的应用程序，使其工作如下：</p>
<p><img src="https://cdn.wydgit.top/blog/docker-multi-app/multi-app-architecture.png"></p>
<h2 id="容器网络"><a href="#容器网络" class="headerlink" title="容器网络"></a>容器网络</h2><p>要记住，默认情况下，容器是独立运行的，并且对同一台机器上的其他进程或容器一无所知。那么，我们如何让一个容器与另一个容器通信呢？答案是<strong>网络</strong>。</p>
<blockquote>
<p>如果两个容器在同一个网络上，它们可以相互通信。如果他们不在，他们就不能相互通信。</p>
</blockquote>
<h2 id="启动-MySQL"><a href="#启动-MySQL" class="headerlink" title="启动 MySQL"></a>启动 MySQL</h2><p>有两种方法可以将容器放在网络上：</p>
<ol>
<li><p>在开始时分配它</p>
</li>
<li><p>连接现有的容器</p>
</li>
</ol>
<p>现在，我们将首先创建网络并在启动时附加 MySQL 容器。</p>
<ol>
<li><p>创建网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create todo-app</span><br></pre></td></tr></table></figure></li>
<li><p>启动一个 MySQL 容器并将其连接到网络。我们还将定义一些数据库将用于初始化数据库的环境变量（请参阅<a target="_blank" rel="noopener" href="https://hub.docker.com/_/mysql/">MySQL Docker Hub 列表中</a>的“环境变量”部分）。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --network todo-app --network-alias mysql \</span><br><span class="line">    -v todo-mysql-data:/var/lib/mysql \</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=secret \</span><br><span class="line">    -e MYSQL_DATABASE=todos \</span><br><span class="line">    mysql:5.7</span><br></pre></td></tr></table></figure>

<p>如果你使用的是 PowerShell，请使用此命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d `</span><br><span class="line">    --network todo-app --network-alias mysql `</span><br><span class="line">    -v todo-mysql-data:/var/lib/mysql `</span><br><span class="line">    -e MYSQL_ROOT_PASSWORD=secret `</span><br><span class="line">    -e MYSQL_DATABASE=todos `</span><br><span class="line">    mysql:5.7</span><br></pre></td></tr></table></figure>

<ul>
<li>-d：<code>daemon</code>简写，表示后台运行</li>
<li>–network todo-app：选择之前创建的网络名称</li>
<li>–network-alias mysql：设置别名</li>
<li>-v todo-mysql-data:/var/lib/mysql：设置数据卷，前者为宿主机文件，后者为容器内文件</li>
<li>-e MYSQL_ROOT_PASSWORD=secret ：设置数据库root用户的密码</li>
<li>-e MYSQL_DATABASE=todos： 创建一个名为todos的数据库</li>
<li>mysql:5.7：选择<code>mysql:5.7</code>的镜像image</li>
</ul>
<p>我们指定了<code>--network-alias</code>标志。稍后我们会回到这个话题。</p>
<blockquote>
<p>提示</p>
<p>注意到我们使用了一个名为<code>todo-mysql-data</code>here的卷并将其安装在<code>/var/lib/mysql</code>，这是 MySQL 存储其数据的地方。但是，我们从未运行过<code>docker volume create</code>命令。Docker 识别出我们想要使用命名卷并自动为我们创建一个。</p>
</blockquote>
</li>
<li><p>要确认我们已启动并运行数据库，请连接到数据库并验证它已连接。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it &lt;mysql-container-id&gt; mysql -p</span><br></pre></td></tr></table></figure>

<p>当密码提示出现时，输入<strong>secret</strong>。在 MySQL shell 中，列出数据库并验证是否看到了<code>todos</code>数据库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW DATABASES;</span><br></pre></td></tr></table></figure>

<p>会看到如下所示的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| todos              |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>欧耶！我们有我们的<code>todos</code>数据库，可以使用了！</p>
</li>
</ol>
<h2 id="连接到-MySQL"><a href="#连接到-MySQL" class="headerlink" title="连接到 MySQL"></a>连接到 MySQL</h2><p>现在我们知道 MySQL 已启动并运行，让我们使用它！但是，问题是……如何？如果我们在同一网络上运行另一个容器，我们如何找到该容器（记住每个容器都有自己的 IP 地址）？</p>
<p>为了解决这个问题，我们将使用<a target="_blank" rel="noopener" href="https://github.com/nicolaka/netshoot">nicolaka/netshoot</a>容器，它附带了许多可用于故障排除或调试网络问题的工具。</p>
<p><em>感觉这一步来创建这个新容器有点多余，其实你们可以不用弄，这里是为了解释这个主机名的由来</em></p>
<ol>
<li><p>使用 nicolaka/netshoot 镜像启动一个新容器。确保将其连接到同一网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --network todo-app nicolaka/netshoot</span><br></pre></td></tr></table></figure></li>
<li><p>在容器内部，我们将使用<code>dig</code>命令，这是一个有用的 DNS 工具。我们将查找主机名的 IP 地址<code>mysql</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig mysql</span><br></pre></td></tr></table></figure>

<p>你会得到这样的输出……</p>
<p>实例的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">; &lt;&lt;&gt;&gt; DiG 9.14.1 &lt;&lt;&gt;&gt; mysql</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 32162</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;mysql.             IN  A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">mysql.          600 IN  A   172.23.0.2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 0 msec</span></span><br><span class="line"><span class="string">;; SERVER: 127.0.0.11#53(127.0.0.11)</span></span><br><span class="line"><span class="string">;; WHEN: Tue Oct 01 23:47:24 UTC 2019</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 44</span></span><br></pre></td></tr></table></figure>

<p>我的输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">; &lt;&lt;&gt;&gt; DiG 9.16.16 &lt;&lt;&gt;&gt; mysql</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- <span class="string">opcode: QUERY, status: NOERROR, id: 3033</span></span><br><span class="line"><span class="string">;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; QUESTION SECTION:</span></span><br><span class="line"><span class="string">;mysql.                         IN      A</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; ANSWER SECTION:</span></span><br><span class="line"><span class="string">mysql.                  600     IN      A       172.18.0.2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">;; Query time: 0 msec</span></span><br><span class="line"><span class="string">;; SERVER: 127.0.0.11#53(127.0.0.11)</span></span><br><span class="line"><span class="string">;; WHEN: Tue Jul 20 04:42:44 UTC 2021</span></span><br><span class="line"><span class="string">;; MSG SIZE  rcvd: 44</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>在“<strong>ANSWER SECTION</strong>”中，你将看到解析为的<code>A</code>记录（你的 IP 地址很可能具有不同的值）。虽然通常不是有效的主机名，但<code>Docker</code>能够将其解析为具有该网络别名的容器的 IP 地址（还记得我们之前使用的标志吗？）。</p>
<p>这意味着……我们的应用程序只需要连接到一个名为的主机<code>mysql</code>，它就会与数据库对话！</p>
</li>
</ol>
<h2 id="使用-MySQL-运行我们的应用程序"><a href="#使用-MySQL-运行我们的应用程序" class="headerlink" title="使用 MySQL 运行我们的应用程序"></a>使用 MySQL 运行我们的应用程序</h2><p>todo 应用程序支持设置一些环境变量来指定 MySQL 连接设置。他们是：</p>
<ul>
<li><code>MYSQL_HOST</code> - 正在运行的 MySQL 服务器的主机名</li>
<li><code>MYSQL_USER</code> - 用于连接的用户名</li>
<li><code>MYSQL_PASSWORD</code> - 用于连接的密码</li>
<li><code>MYSQL_DB</code> - 连接后使用的数据库</li>
</ul>
<blockquote>
<p>警告</p>
<p>虽然使用 env vars 来设置连接设置对于开发来说通常是可以的，但在生产中运行应用程序时，这是<strong>非常不推荐的</strong>。Docker 前安全主管 Diogo Monica<a target="_blank" rel="noopener" href="https://diogomonica.com/2017/03/27/why-you-shouldnt-use-env-variables-for-secret-data/">写了一篇博客文章</a>解释了原因。</p>
<p>更安全的机制是使用你的容器编排框架提供的秘密支持。在大多数情况下，这些机密作为文件安装在正在运行的容器中。你会看到许多应用程序（包括 MySQL 映像和 todo 应用程序）也支持 env vars，<code>_FILE</code>后缀指向包含该变量的文件。</p>
<p>例如，设置<code>MYSQL_PASSWORD_FILE</code>var 将导致应用程序使用引用文件的内容作为连接密码。Docker 不做任何事情来支持这些环境变量。你的应用程序需要知道查找变量并获取文件内容。</p>
</blockquote>
<p>解释完所有这些之后，就可以启动我们开发就绪的容器！</p>
<p><strong>需要注意：</strong></p>
<blockquote>
<p>这里我们使用了<code>$(pwd)</code>这个参数，它是只当前本目录，所以我们应该进入到**本地目录下的app/**目录下，这里我之前没有进入正确的目录下，导致容器一直启动失败。</p>
</blockquote>
<ol>
<li><p>我们将指定上面的每个环境变量，并将容器连接到我们的应用程序网络。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 8888:3000 \</span><br><span class="line">  -w /app -v <span class="string">&quot;<span class="subst">$(pwd)</span>:/app&quot;</span> \</span><br><span class="line">  --network todo-app \</span><br><span class="line">  -e MYSQL_HOST=mysql \</span><br><span class="line">  -e MYSQL_USER=root \</span><br><span class="line">  -e MYSQL_PASSWORD=secret \</span><br><span class="line">  -e MYSQL_DB=todos \</span><br><span class="line">  node:12-alpine \</span><br><span class="line">  sh -c <span class="string">&quot;yarn install &amp;&amp; yarn run dev&quot;</span></span><br></pre></td></tr></table></figure>

<p><em>我这里使用 bash 报错了，所以我后面使用 PowerShell 后就成功了</em></p>
<p>如果你使用的是 PowerShell，请使用此命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 8888:3000 `</span><br><span class="line">  -w /app -v <span class="string">&quot;<span class="subst">$(pwd)</span>:/app&quot;</span> `</span><br><span class="line">  --network todo-app `</span><br><span class="line">  -e MYSQL_HOST=mysql `</span><br><span class="line">  -e MYSQL_USER=root `</span><br><span class="line">  -e MYSQL_PASSWORD=secret `</span><br><span class="line">  -e MYSQL_DB=todos `</span><br><span class="line">  node:12-alpine `</span><br><span class="line">  sh -c <span class="string">&quot;yarn install &amp;&amp; yarn run dev&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><p>启动之后，会返回一个container ID，我们来检测下情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 查看容器状态是否在运行</span><br><span class="line">docker ps -a</span><br><span class="line">// 我的结果</span><br><span class="line">CONTAINER ID    IMAGE            CREATED          STATUS           PORTS         </span><br><span class="line">e3dd1fe96684    node:12-alpine   3 minutes ago    Up 3 minutes     0.0.0.0:8888-&gt;3000/tcp, :::8888-&gt;3000/tcp   </span><br></pre></td></tr></table></figure></li>
<li><p>如果我们查看容器 ( <code>docker logs &lt;container-id&gt;</code>)的日志，我们应该会看到一条消息，表明它正在使用 mysql 数据库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Previous log messages omitted</span></span><br><span class="line">$ nodemon src/index.js</span><br><span class="line">[nodemon] 1.19.2</span><br><span class="line">[nodemon] to restart at any time, enter `rs`</span><br><span class="line">[nodemon] watching dir(s): *.*</span><br><span class="line">[nodemon] starting `node src/index.js`</span><br><span class="line">Connected to mysql db at host mysql</span><br><span class="line">Listening on port 8888</span><br></pre></td></tr></table></figure></li>
<li><p>在浏览器中输入：<code>http://localhost:8888/</code>打开该应用程序，并输入一些字符串添加到你的待办事项列表中。</p>
<p>需要注意的是，要用<code>英文</code>、<code>数字</code>，不能使用<code>中文</code>字符。（如果要使用，可以研究下数据库代码来进行配置哦 :wink: ）</p>
</li>
<li><p>连接mysql数据库，证明项目正在写入数据库。请记住，密码是<strong>secret</strong>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it &lt;mysql-container-id&gt; mysql -p todos</span><br></pre></td></tr></table></figure>

<p>在 mysql shell 中，运行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from todo_items;</span><br><span class="line">+--------------------------------------+---------+-----------+</span><br><span class="line">| id                                   | name    | completed |</span><br><span class="line">+--------------------------------------+---------+-----------+</span><br><span class="line">| 444454fc-709f-4088-8fb6-d6a965ef4cef | ffff    |         0 |</span><br><span class="line">| ca7cb357-9c5c-4c8c-8020-1c6e1c56fb4c | check   |         0 |</span><br><span class="line">| 3ced0027-dd54-4c27-845a-3ad3e238d86e | home    |         0 |</span><br><span class="line">| 4775a3aa-86fa-470e-a719-9a583802ff4e | go work |         0 |</span><br><span class="line">| cbb728b5-f23a-4af0-8d8d-f26271383685 | go home |         0 |</span><br><span class="line">+--------------------------------------+---------+-----------+</span><br></pre></td></tr></table></figure>

<p>可能每个人的数据表看起来会有所不同。</p>
</li>
</ol>
<p>如果你快速查看 Docker 仪表板，你会看到我们有两个应用程序容器正在运行。但是，没有真正的迹象表明它们被组合在一个应用程序中。</p>
<p><img src="https://cdn.wydgit.top/blog/docker-multi-app/dashboard-multi-container-app.png" alt="Docker 仪表板显示两个未分组的应用程序容器"></p>
<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><strong>Windows</strong></p>
<p>如果已经安装了Docker Desktop，那么就不用再安装了</p>
<p><strong>Linux</strong></p>
<ol>
<li><p>运行此命令以下载 Docker Compose 的当前稳定版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https:&#x2F;&#x2F;github.com&#x2F;docker&#x2F;compose&#x2F;releases&#x2F;download&#x2F;1.29.2&#x2F;docker-compose-$(uname -s)-$(uname -m)&quot; -o &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure>

<blockquote>
<p>要安装不同版本的 Compose，请替换<code>1.29.2</code> 为你要使用的 Compose 版本。</p>
</blockquote>
<p>如果你在安装时遇到问题<code>curl</code>，请参阅 上面的<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/install/#alternative-install-options">替代安装选项选项</a>卡。</p>
</li>
<li><p>对二进制文件应用可执行权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-compose</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<p><strong>注意</strong>：如果<code>docker-compose</code>安装后命令失败，请检查你的路径。你还可以<code>/usr/bin</code>在路径中创建指向或任何其他目录的符号链接。</p>
</blockquote>
<h3 id="配置、使用"><a href="#配置、使用" class="headerlink" title="配置、使用"></a>配置、使用</h3><p>请记住，这是我们用来定义应用程序容器的命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 8888:3000 \</span><br><span class="line">  -w &#x2F;app -v &quot;$(pwd):&#x2F;app&quot; \</span><br><span class="line">  --network todo-app \</span><br><span class="line">  -e MYSQL_HOST&#x3D;mysql \</span><br><span class="line">  -e MYSQL_USER&#x3D;root \</span><br><span class="line">  -e MYSQL_PASSWORD&#x3D;secret \</span><br><span class="line">  -e MYSQL_DB&#x3D;todos \</span><br><span class="line">  node:12-alpine \</span><br><span class="line">  sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br></pre></td></tr></table></figure>

<p>如果你使用的是 PowerShell，请使用此命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 8888:3000 &#96;</span><br><span class="line">  -w &#x2F;app -v &quot;$(pwd):&#x2F;app&quot; &#96;</span><br><span class="line">  --network todo-app &#96;</span><br><span class="line">  -e MYSQL_HOST&#x3D;mysql &#96;</span><br><span class="line">  -e MYSQL_USER&#x3D;root &#96;</span><br><span class="line">  -e MYSQL_PASSWORD&#x3D;secret &#96;</span><br><span class="line">  -e MYSQL_DB&#x3D;todos &#96;</span><br><span class="line">  node:12-alpine &#96;</span><br><span class="line">  sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>首先，让我们为容器定义服务条目和图像。我们可以为服务选择任何名称。该名称将自动成为网络别名，这在定义我们的 MySQL 服务时会很有用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br></pre></td></tr></table></figure></li>
<li><p>通常，你会在<code>image</code>定义附近看到命令，尽管对排序没有要求。所以，让我们继续把它移到我们的文件中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br><span class="line">    command: sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br></pre></td></tr></table></figure></li>
<li><p>让我们<code>-p 8888:3000</code>通过<code>ports</code>为服务定义来迁移命令的一部分。我们将在这里使用<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#short-syntax-1">短语法</a>，但也有更详细的<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#long-syntax-1">长语法</a>可用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br><span class="line">    command: sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - 8888:3000</span><br></pre></td></tr></table></figure></li>
<li><p>接下来，我们将使用和定义迁移工作目录 ( <code>-w /app</code>) 和卷映射 ( <code>-v &quot;$(pwd):/app&quot;</code>) 。Volumes 也有<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#short-syntax-3">短句</a>和<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#long-syntax-3">长</a>句。<code>working_dir``volumes</code></p>
<p>Docker Compose 卷定义的优点之一是我们可以使用当前目录的相对路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br><span class="line">    command: sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - 8888:3000</span><br><span class="line">    working_dir: &#x2F;app</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;:&#x2F;app</span><br></pre></td></tr></table></figure></li>
<li><p>最后，我们需要使用<code>environment</code>密钥迁移环境变量定义。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br><span class="line">    command: sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - 8888:3000</span><br><span class="line">    working_dir: &#x2F;app</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;:&#x2F;app</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_HOST: mysql</span><br><span class="line">      MYSQL_USER: root</span><br><span class="line">      MYSQL_PASSWORD: secret</span><br><span class="line">      MYSQL_DB: todos</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="定义-MySQL-服务"><a href="#定义-MySQL-服务" class="headerlink" title="定义 MySQL 服务"></a>定义 MySQL 服务</h3><p>现在，是时候定义 MySQL 服务了。我们用于该容器的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --network todo-app --network-alias mysql \</span><br><span class="line">  -v todo-mysql-data:&#x2F;var&#x2F;lib&#x2F;mysql \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD&#x3D;secret \</span><br><span class="line">  -e MYSQL_DATABASE&#x3D;todos \</span><br><span class="line">  mysql:5.7</span><br></pre></td></tr></table></figure>

<p>如果你使用的是 PowerShell，请使用此命令。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d &#96;</span><br><span class="line">  --network todo-app --network-alias mysql &#96;</span><br><span class="line">  -v todo-mysql-data:&#x2F;var&#x2F;lib&#x2F;mysql &#96;</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD&#x3D;secret &#96;</span><br><span class="line">  -e MYSQL_DATABASE&#x3D;todos &#96;</span><br><span class="line">  mysql:5.7</span><br></pre></td></tr></table></figure>

<p>我们将首先定义新服务并为其命名，<code>mysql</code>以便它自动获取网络别名。我们将继续并指定要使用的图像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    # The app service definition</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br></pre></td></tr></table></figure>

<ol>
<li><p>接下来，我们将定义卷映射。当我们使用 运行容器时<code>docker run</code>，会自动创建命名卷。但是，使用 Compose 运行时不会发生这种情况。我们需要在顶级<code>volumes:</code>部分定义卷，然后在服务配置中指定挂载点。通过仅提供卷名，使用默认选项。不过，还有<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/#volume-configuration-reference">更多可用选项</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    # The app service definition</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    volumes:</span><br><span class="line">      - todo-mysql-data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  todo-mysql-data:</span><br></pre></td></tr></table></figure></li>
<li><p>最后，我们只需要指定环境变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    # The app service definition</span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    volumes:</span><br><span class="line">      - todo-mysql-data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">    environment: </span><br><span class="line">      MYSQL_ROOT_PASSWORD: secret</span><br><span class="line">      MYSQL_DATABASE: todos</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  todo-mysql-data:</span><br></pre></td></tr></table></figure></li>
</ol>
<p>此时，我们的完整<code>docker-compose.yml</code>应该是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.8&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  app:</span><br><span class="line">    image: node:12-alpine</span><br><span class="line">    command: sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br><span class="line">    ports:</span><br><span class="line">      - 8888:3000</span><br><span class="line">    working_dir: &#x2F;app</span><br><span class="line">    volumes:</span><br><span class="line">      - .&#x2F;:&#x2F;app</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_HOST: mysql</span><br><span class="line">      MYSQL_USER: root</span><br><span class="line">      MYSQL_PASSWORD: secret</span><br><span class="line">      MYSQL_DB: todos</span><br><span class="line"></span><br><span class="line">  mysql:</span><br><span class="line">    image: mysql:5.7</span><br><span class="line">    volumes:</span><br><span class="line">      - todo-mysql-data:&#x2F;var&#x2F;lib&#x2F;mysql</span><br><span class="line">    environment: </span><br><span class="line">      MYSQL_ROOT_PASSWORD: secret</span><br><span class="line">      MYSQL_DATABASE: todos</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  todo-mysql-data:</span><br></pre></td></tr></table></figure>

<h3 id="运行我们的应用程序堆栈"><a href="#运行我们的应用程序堆栈" class="headerlink" title="运行我们的应用程序堆栈"></a>运行我们的应用程序堆栈</h3><p>现在我们有了我们的<code>docker-compose.yml</code>文件，我们可以启动它了！</p>
<ol>
<li><p>确保没有其他 app/db 副本首先运行（<code>docker ps</code>和<code>docker rm -f &lt;ids&gt;</code>）。</p>
</li>
<li><p>使用<code>docker-compose up</code>命令启动应用程序堆栈。我们将添加<code>-d</code>标志以在后台运行所有内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>当我们运行它时，我们应该看到这样的输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Creating network &quot;app_default&quot; with the default driver</span><br><span class="line">Creating volume &quot;app_todo-mysql-data&quot; with default driver</span><br><span class="line">Creating app_app_1   ... done</span><br><span class="line">Creating app_mysql_1 ... done</span><br></pre></td></tr></table></figure>

<p>你会注意到创建了卷以及网络！</p>
<p><em>默认情况下，Docker Compose 会自动为应用程序堆栈创建一个网络（这就是我们没有在 compose 文件中定义网络的原因）。</em></p>
</li>
<li><p>让我们使用<code>docker-compose logs -f</code>命令查看日志。你将看到来自每个服务的日志交错到一个流中。当你想观察与时序相关的问题时，这非常有用。该<code>-f</code>标志“跟随”的日志，因为它产生这样会给你现场输出。</p>
<p>如果你还没有，你会看到看起来像这样的输出……</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql_1  | 2019-10-03T03:07:16.083639Z 0 [Note] mysqld: ready for connections.</span><br><span class="line">mysql_1  | Version: &#39;5.7.27&#39;  socket: &#39;&#x2F;var&#x2F;run&#x2F;mysqld&#x2F;mysqld.sock&#39;  port: 3306  MySQL Community Server (GPL)</span><br><span class="line">app_1    | Connected to mysql db at host mysql</span><br><span class="line">app_1    | Listening on port 8</span><br></pre></td></tr></table></figure>

<p>服务名称显示在行首（通常是彩色的）以帮助区分消息。如果要查看特定服务的日志，可以在logs 命令的末尾添加服务名称（例如，<code>docker-compose logs -f app</code>）。</p>
<blockquote>
<p>专业提示 - 在启动应用程序之前等待数据库</p>
<p>当应用程序启动时，它实际上会等待 MySQL 启动并准备好，然后再尝试连接到它。Docker 没有任何内置支持在启动另一个容器之前等待另一个容器完全启动、运行和准备就绪。对于基于 Node 的项目，你可以使用<a target="_blank" rel="noopener" href="https://github.com/dwmkerr/wait-port">等待端口</a>依赖项。其他语言/框架也存在类似的项目。</p>
</blockquote>
</li>
<li><p>此时，你应该能够打开你的应用程序并看到它正在运行。嘿！我们只需要一个命令！</p>
</li>
</ol>
<h3 id="拆除我们的应用堆栈"><a href="#拆除我们的应用堆栈" class="headerlink" title="拆除我们的应用堆栈"></a>拆除我们的应用堆栈</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<p>然后就会看到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose down</span><br><span class="line">Stopping app_app_1   ...</span><br><span class="line">Stopping app_mysql_1 ...</span><br><span class="line">Stopping app_app_1   ... <span class="keyword">done</span></span><br><span class="line">Stopping app_mysql_1 ... <span class="keyword">done</span></span><br><span class="line">Removing app_app_1   ...</span><br><span class="line">Removing app_mysql_1 ...</span><br><span class="line">Removing app_mysql_1 ... <span class="keyword">done</span></span><br><span class="line">Removing app_app_1   ... <span class="keyword">done</span></span><br><span class="line">Removing network app_default</span><br></pre></td></tr></table></figure>

<p>容器将停止，网络将被移除。默认情况下，运行<code>docker-compose down</code>. 如果要删除卷，则需要添加<code>--volumes</code>标志。</p>
<p>拆除后，你可以切换到另一个项目，运行<code>docker-compose up</code>开始新的项目。</p>
<h3 id="在-Docker-仪表板中查看我们的应用程序堆栈"><a href="#在-Docker-仪表板中查看我们的应用程序堆栈" class="headerlink" title="在 Docker 仪表板中查看我们的应用程序堆栈"></a>在 Docker 仪表板中查看我们的应用程序堆栈</h3><p>如果我们查看 Docker 仪表板，我们会看到有一个名为<strong>app</strong>的组。这是来自 Docker Compose 的“项目名称”，用于将容器组合在一起。默认情况下，项目名称只是所在目录的名称<code>docker-compose.yml</code>。</p>
<p>如果你向下旋转应用程序，你将看到我们在撰写文件中定义的两个容器。这些名称也更具描述性，因为它们遵循<code>&lt;project-name&gt;_&lt;service-name&gt;_&lt;replica-number&gt;</code>. 因此，很容易快速查看哪个容器是我们的应用程序，哪个容器是 mysql 数据库。</p>
<p><img src="https://cdn.wydgit.top/blog/docker-multi-app/dashboard-app-project-expanded.png" alt="带有应用程序项目的 Docker 仪表板"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/docker/getting-started/tree/master/docs/tutorial">Docker-getting-started-tutorial</a></p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Docker/">Docker</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/http-referrer/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">防盗链？</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/win10-network-icon-bug/"><span class="level-item">解决Win10更新后网络图标bug</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#前言"><span class="level-left"><span class="level-item">1</span><span class="level-item">前言</span></span></a></li><li><a class="level is-mobile" href="#容器网络"><span class="level-left"><span class="level-item">2</span><span class="level-item">容器网络</span></span></a></li><li><a class="level is-mobile" href="#启动-MySQL"><span class="level-left"><span class="level-item">3</span><span class="level-item">启动 MySQL</span></span></a></li><li><a class="level is-mobile" href="#连接到-MySQL"><span class="level-left"><span class="level-item">4</span><span class="level-item">连接到 MySQL</span></span></a></li><li><a class="level is-mobile" href="#使用-MySQL-运行我们的应用程序"><span class="level-left"><span class="level-item">5</span><span class="level-item">使用 MySQL 运行我们的应用程序</span></span></a></li><li><a class="level is-mobile" href="#Docker-Compose"><span class="level-left"><span class="level-item">6</span><span class="level-item">Docker Compose</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#安装"><span class="level-left"><span class="level-item">6.1</span><span class="level-item">安装</span></span></a></li><li><a class="level is-mobile" href="#配置、使用"><span class="level-left"><span class="level-item">6.2</span><span class="level-item">配置、使用</span></span></a></li><li><a class="level is-mobile" href="#定义-MySQL-服务"><span class="level-left"><span class="level-item">6.3</span><span class="level-item">定义 MySQL 服务</span></span></a></li><li><a class="level is-mobile" href="#运行我们的应用程序堆栈"><span class="level-left"><span class="level-item">6.4</span><span class="level-item">运行我们的应用程序堆栈</span></span></a></li><li><a class="level is-mobile" href="#拆除我们的应用堆栈"><span class="level-left"><span class="level-item">6.5</span><span class="level-item">拆除我们的应用堆栈</span></span></a></li><li><a class="level is-mobile" href="#在-Docker-仪表板中查看我们的应用程序堆栈"><span class="level-left"><span class="level-item">6.6</span><span class="level-item">在 Docker 仪表板中查看我们的应用程序堆栈</span></span></a></li></ul></li><li><a class="level is-mobile" href="#参考资料"><span class="level-left"><span class="level-item">7</span><span class="level-item">参考资料</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Axios/"><span class="tag">Axios</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CSS/"><span class="tag">CSS</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Cross-domin/"><span class="tag">Cross-domin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Structure/"><span class="tag">Data Structure</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Electron/"><span class="tag">Electron</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Express/"><span class="tag">Express</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/FTP/"><span class="tag">FTP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Flex/"><span class="tag">Flex</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Https/"><span class="tag">Https</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaScript/"><span class="tag">JavaScript</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Markdown/"><span class="tag">Markdown</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NPM/"><span class="tag">NPM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/NVM/"><span class="tag">NVM</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Network/"><span class="tag">Network</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Node/"><span class="tag">Node</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Others/"><span class="tag">Others</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Path/"><span class="tag">Path</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RegExp/"><span class="tag">RegExp</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SCP/"><span class="tag">SCP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SFTP/"><span class="tag">SFTP</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/SSH/"><span class="tag">SSH</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Sublime/"><span class="tag">Sublime</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Svg/"><span class="tag">Svg</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Uni-app/"><span class="tag">Uni-app</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Vue/"><span class="tag">Vue</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Win10/"><span class="tag">Win10</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo.svg" alt="阿东zza" height="28"></a><p class="is-size-7"><span>&copy; 2023 adyoow</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>